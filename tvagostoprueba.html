<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Reproductor de TV</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: Arial, sans-serif;
            background-color: #1e1e1e;
            color: #fff;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        /* Ajustar esta regla existente */
.video-container {
    height: 40vh;
    width: 100%;
    background: #000;
    position: relative;
    margin-top: 10px;
    transition: height 0.3s ease; /* Añadir transición suave */
}

/* Añadir esta nueva regla */
.video-container.expanded {
    height: 85vh; /* O el valor que prefieras */
}
        #videoElement {
            width: 100%;
            height: 100%;
            background: #000;
        }
        #platformFrame {
            width: 100%;
            height: 100%;
            border: none;
            display: none;
        }
        .channel-info {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background: rgba(0,0,0,0.7);
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 14px;
            max-width: 80%;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .channel-list {
            flex: 1;
            overflow-y: auto;
            background: #2c2c2c;
            padding: 10px;
        }
        .channel-item {
            padding: 12px 8px;
            border-bottom: 1px solid #444;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: background 0.2s;
        }
        .channel-item:hover {
            background: #3c3c3c;
        }
        .channel-item.selected {
            background-color: #4CAF50;
            color: white;
        }
        .button.multiselect-active {
            background: #4CAF50;
        }
        .button.multiselect-inactive {
            background: #f44336;
        }
        .channel-name {
            flex: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            cursor: pointer;
            font-weight: bold;
        }
        .channel-type {
            font-size: 10px;
            background: #666;
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: 8px;
        }
        .favorite-toggle {
            width: 24px;
            height: 24px;
            border: 1px solid #666;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: 10px;
            cursor: pointer;
            background: #444;
        }
        .favorite-toggle.active {
            background: #ffeb3b;
            color: black;
        }
        .buttons-container {
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            background: #2c2c2c;
            flex-wrap: wrap;
            position: relative;
            border-top: 1px solid #444;
        }
        .button {
            padding: 8px 12px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 4px;
            flex-grow: 1;
            max-width: 15%;
            min-width: 65px;
        }
        .button:active {
            background: #3e8e41;
        }
        .button.secondary {
            background: #f0ad4e;
            color: black;
        }
        .button.secondary:active {
            background: #ec971f;
            color: black;
        }
        .button.tv-mode {
            background: #1565c0 !important;
            color: #fff !important;
        }
        .channel-counter {
            padding: 8px 12px;
            margin: 2px;
            font-weight: bold;
            color: #fff;
            text-align: center;
            background: #444;
            border-radius: 4px;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background: #2c2c2c;
            padding: 20px;
            border-radius: 8px;
            width: 90%;
            max-width: 400px;
            color: #fff;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
        }
        .modal-input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #444;
            border-radius: 4px;
            background: #3c3c3c;
            color: #fff;
        }
        .modal-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
        }
        .modal-button {
            padding: 8px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .modal-button.primary {
            background: #4CAF50;
            color: white;
        }
        .modal-button.secondary {
            background: #f44336;
            color: white;
        }
        .search-container {
            display: none;
            padding: 10px;
            background: #2c2c2c;
            border-bottom: 1px solid #444;
        }
        .search-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #444;
            border-radius: 4px;
            background: #3c3c3c;
            color: #fff;
        }
        .secondary-buttons {
            display: none;
            width: 100%;
            flex-wrap: wrap;
            justify-content: space-around;
        }
        .show-secondary {
            display: flex;
        }
        .tv-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 10px 0;
        }
        .tv-scroll-btn {
            font-size: 1.6em;
            background: #1565c0;
            color: #fff;
            border: none;
            border-radius: 6px;
            padding: 10px 22px;
            margin: 0 20px;
            cursor: pointer;
            user-select: none;
        }
        .tv-scroll-btn:active {
            background: #004ba0;
        }
        .fullscreen-btn {
            background: #1976d2 !important;
            color: #fff !important;
            font-size: 1em;
            margin-left: 8px;
            min-width: 90px;
        }
        .play-btn-tv {
            background: #43a047 !important;
            color: #fff !important;
            font-size: 1em;
            margin-left: 8px;
            min-width: 90px;
        }
        .hidden {
            display: none !important;
        }
        /* NUEVAS LÍNEAS PARA EL SELECT DE PLATAFORMA */
        .platform-filter-container {
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 6px 0 0 0;
        }
        .platform-filter-select {
            padding: 7px 16px;
            border-radius: 4px;
            border: 1px solid #444;
            background: #222;
            color: #fff;
            font-size: 1em;
            margin: 0 0 10px 0;
        }
        .platform-filter-label {
            margin-right: 10px;
            font-size: 1em;
            color: #eee;
        }
        
        
             .navigation-controls {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: none;
            z-index: 10000; /* Alto z-index para estar sobre todo */
            flex-direction: column;
            gap: 10px;
        }
        
        .nav-btn {
            padding: 12px 16px;
            border: none;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0,0,0,0.5);
            font-size: 14px;
            min-width: 100px;
        }
        
        .prev-btn {
            background-color: #2196F3;
            color: white;
        }
        
        .next-btn {
            background-color: #4CAF50;
            color: white;
        }
        
        .toggle-nav-btn {
            position: fixed;
            bottom: 20px;
            left: 20px;
            padding: 10px 15px;
            border: none;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            z-index: 10000; /* Alto z-index para estar sobre todo */
            box-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }
        
        .toggle-nav-btn.off {
            background-color: #f44336;
            color: white;
        }
        
        .toggle-nav-btn.on {
            background-color: #4CAF50;
            color: black;
        }
        
        .toggle-list-btn {
    position: sticky;
    top: 0;
    z-index: 100;
    width: 100%;
    padding: 12px;
    background-color: #333;
    color: white;
    border: none;
    border-bottom: 1px solid #555;
    text-align: center;
    cursor: pointer;
    font-weight: bold;
}

.toggle-list-btn:hover {
    background-color: #444;
}

.channel-list.collapsed {
    display: none;
}

        
    </style>
</head>
<body>
    <div class="video-container">
        <video id="videoElement" controls></video>
        <iframe id="platformFrame" allowfullscreen></iframe>
        <div class="channel-info" id="channelInfo"></div>
    </div>
   <button class="toggle-nav-btn off" id="toggleNavBtn">OFF</button>
    <div class="navigation-controls" id="navigationControls">
        <button class="nav-btn prev-btn" id="prevBtn">Anterior</button>
        <button class="nav-btn next-btn" id="nextBtn">Siguiente</button>
    </div>
    
    <div class="tv-controls" id="tvControls" style="display:none;">
        <button class="tv-scroll-btn" id="scrollUpBtn" tabindex="1">▲</button>
        <button class="button tv-mode" id="tvModeButton" tabindex="2">Modo TV</button>
        <button class="play-btn-tv" id="playBtnTv" tabindex="4">Play</button>
        <button class="button fullscreen-btn" id="fullscreenBtn" tabindex="3">Pantalla completa</button>
        <button class="tv-scroll-btn" id="scrollDownBtn" tabindex="5">▼</button>
    </div>

    <div class="buttons-container" id="buttonsContainer">
        <button class="button" id="loadButton">Cargar</button>
        <button class="button" id="searchButton">Buscar</button>
        <button class="button tv-mode" id="tvModeButtonAndroid">Modo TV</button>
        <button class="button fullscreen-btn" id="fullscreenBtnAndroid">Pantalla completa</button>
        <button class="button" id="moreButton">Más</button>
        <div class="secondary-buttons" id="secondaryButtons">
            <button class="button" id="saveButton">Guardar</button>
            <button class="button" id="favButton">Favoritos</button>
            <button class="button" id="allButton">Todos</button>
            <button class="button secondary" id="urlButton">URL</button>
            <button class="button secondary" id="addButton">Añadir</button>
            <button class="button secondary" id="editButton">Editar</button>
            <button class="button secondary" id="removeButton">Quitar</button>
            <button class="button" id="selectAllButton">Selecfull</button>
            <button class="button" id="deselectAllButton">Deselfull</button>
            <button class="button" id="repSelecButton">RepSelec</button>
<button class="button secondary" id="timerButton">Temporizador</button>
            <div class="platform-filter-container">
                <label for="platformFilterSelect" class="platform-filter-label">Filtrar plataforma:</label>
                <select id="platformFilterSelect" class="platform-filter-select">
                    <option value="all">Todas</option>
                    <option value="youtube">YouTube</option>
                    <option value="dailymotion">Dailymotion</option>
                    <option value="okru">ok.ru</option>
                    <option value="TV">TV</option>
                    
                </select>
            </div>
            <div class="channel-counter" id="channelCounter">Canales: 0</div>
        </div>
    </div>

    <div class="search-container" id="searchContainer">
        <input type="text" class="search-input" id="searchInput" placeholder="Buscar canales...">
    </div>
    <!-- Añadir este botón justo antes del channel-list -->
<button class="toggle-list-btn" id="toggleListBtn">▼ Ocultar Lista</button>

<div class="channel-list" id="channelList">
    <div class="channel-item">Cargue una lista para comenzar</div>
</div>

    <div class="channel-list" id="channelList">
        <div class="channel-item">Cargue una lista para comenzar</div>
    </div>

    <input type="file" id="fileInput" accept=".txt,.md,.m3u,.m3u8,.json,.JSON">

    <div class="modal" id="urlModal">
        <div class="modal-content">
            <h3>Introduce la URL de la lista</h3>
            <input type="text" class="modal-input" id="urlInput" placeholder="https://ejemplo.com/lista.m3u o .json">
            <div class="modal-buttons">
                <button class="modal-button primary" id="downloadButton">Descargar</button>
                <button class="modal-button secondary" id="cancelButton">Cancelar</button>
            </div>
        </div>
    </div>
<div class="modal" id="timerModal">
    <div class="modal-content">
        <h3>Temporizador de reproducción (minutos)</h3>
        <input type="number" class="modal-input" id="timerInput" min="1" placeholder="Minutos">
        <div class="modal-buttons">
            <button class="modal-button primary" id="setTimerButton">Aceptar</button>
            <button class="modal-button secondary" id="cancelTimerButton">Cancelar</button>
        </div>
    </div>
</div>
    <div class="modal" id="addChannelModal">
        <div class="modal-content">
            <h3 id="addEditModalTitle">Añadir nuevo canal</h3>
            <input type="text" class="modal-input" id="channelNameInput" placeholder="Nombre del canal">
            <input type="text" class="modal-input" id="channelUrlInput" placeholder="URL del canal">
            <div class="modal-buttons">
                <button class="modal-button primary" id="addChannelButton">Añadir</button>
                <button class="modal-button secondary" id="cancelAddChannelButton">Cancelar</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script>
    // Variables globales
    let navigationEnabled = false;
    let currentChannelIndex = -1;
    // Añadir estas variables con las demás variables globales
let isListExpanded = false;
    let channelsData = [];
    let hls = null;
    let favorites = JSON.parse(localStorage.getItem('favorites')) || [];
    let selectedChannels = [];
    let currentSelectedChannel = null;
    let currentDisplayMode = 'all';
    let currentSearchTerm = '';
    let channelStatuses = {};
    let isUsingPlatformPlayer = false;
    let isEditMode = false;
    let editChannelIndex = null;
    let tvMode = false;
    // NUEVA VARIABLE PARA PLATAFORMA
    let currentPlatformFilter = 'all';
// Para RepSelec
let repSelecIndex = 0;
let repSelecPlaying = false;

// Para temporizador
let timerTimeout = null;
let timerModal = document.getElementById('timerModal');
let timerInput = document.getElementById('timerInput');
let setTimerButton = document.getElementById('setTimerButton');
let cancelTimerButton = document.getElementById('cancelTimerButton');
let timerButton = document.getElementById('timerButton');
    const DEFAULT_LIST_URL = "https://yagopc.github.io/Cine/documentalesdailymotion.m3u";
    let isUsingDefaultList = false;

    // Elementos del DOM
    const toggleNavBtn = document.getElementById('toggleNavBtn');
    const navigationControls = document.getElementById('navigationControls');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    
    const loadButton = document.getElementById('loadButton');
    const saveButton = document.getElementById('saveButton');
    const favButton = document.getElementById('favButton');
    const allButton = document.getElementById('allButton');
    const searchButton = document.getElementById('searchButton');
    const urlButton = document.getElementById('urlButton');
    const addButton = document.getElementById('addButton');
    const editButton = document.getElementById('editButton');
    const removeButton = document.getElementById('removeButton');
    const selectAllButton = document.getElementById('selectAllButton');
    const deselectAllButton = document.getElementById('deselectAllButton');
    const fileInput = document.getElementById('fileInput');
    const channelList = document.getElementById('channelList');
    const videoElement = document.getElementById('videoElement');
    const platformFrame = document.getElementById('platformFrame');
    const channelInfo = document.getElementById('channelInfo');
    const urlModal = document.getElementById('urlModal');
    const urlInput = document.getElementById('urlInput');
    const downloadButton = document.getElementById('downloadButton');
    const cancelButton = document.getElementById('cancelButton');
    const searchContainer = document.getElementById('searchContainer');
    const searchInput = document.getElementById('searchInput');
    const channelCounter = document.getElementById('channelCounter');
    const addChannelModal = document.getElementById('addChannelModal');
    const channelNameInput = document.getElementById('channelNameInput');
    const channelUrlInput = document.getElementById('channelUrlInput');
    const addChannelButton = document.getElementById('addChannelButton');
    const cancelAddChannelButton = document.getElementById('cancelAddChannelButton');
    const moreButton = document.getElementById('moreButton');
    const secondaryButtons = document.getElementById('secondaryButtons');
    const tvModeButton = document.getElementById('tvModeButton');
    const tvModeButtonAndroid = document.getElementById('tvModeButtonAndroid');
    const fullscreenBtn = document.getElementById('fullscreenBtn');
    const fullscreenBtnAndroid = document.getElementById('fullscreenBtnAndroid');
    const tvControls = document.getElementById('tvControls');
    const scrollUpBtn = document.getElementById('scrollUpBtn');
    const scrollDownBtn = document.getElementById('scrollDownBtn');
    const addEditModalTitle = document.getElementById('addEditModalTitle');
    const playBtnTv = document.getElementById('playBtnTv');
    // NUEVO: Select de plataforma
    const platformFilterSelect = document.getElementById('platformFilterSelect');

    function toggleSecondaryButtons() {
        if (secondaryButtons.classList.contains('show-secondary')) {
            secondaryButtons.classList.remove('show-secondary');
            moreButton.textContent = 'Más';
        } else {
            secondaryButtons.classList.add('show-secondary');
            moreButton.textContent = 'Menos';
        }
    }
    function toggleChannelList() {
    const channelList = document.getElementById('channelList');
    const videoContainer = document.querySelector('.video-container');
    const toggleBtn = document.getElementById('toggleListBtn');
    
    isListExpanded = !isListExpanded;
    
    if (isListExpanded) {
        // Expandir: ocultar lista, agrandar video
        channelList.classList.add('collapsed');
        videoContainer.classList.add('expanded');
        toggleBtn.textContent = '▲ Mostrar Lista';
    } else {
        // Retraer: mostrar lista, tamaño normal de video
        channelList.classList.remove('collapsed');
        videoContainer.classList.remove('expanded');
        toggleBtn.textContent = '▼ Ocultar Lista';
    }
}

    function scrollChannelList(direction) {
        const items = Array.from(channelList.querySelectorAll('.channel-item'));
        const selected = items.findIndex(item => item.classList.contains('selected'));
        let nextIndex = 0;
        if (direction === 'up') {
            if (selected <= 0) nextIndex = 0;
            else nextIndex = selected - 1;
        } else {
            if (selected === -1) nextIndex = 0;
            else nextIndex = Math.min(items.length - 1, selected + 1);
        }
        items.forEach(item => item.classList.remove('selected'));
        if (items[nextIndex]) {
            items[nextIndex].classList.add('selected');
            items[nextIndex].scrollIntoView({block:'center'});
            currentSelectedChannel = getCurrentFilteredChannels()[nextIndex] || null;
        }
        updateSelectedChannels();
    }

    function enterFullscreen() {
        if (!isUsingPlatformPlayer && videoElement.style.display !== "none") {
            if (videoElement.requestFullscreen) videoElement.requestFullscreen();
            else if (videoElement.mozRequestFullScreen) videoElement.mozRequestFullScreen();
            else if (videoElement.webkitRequestFullscreen) videoElement.webkitRequestFullscreen();
            else if (videoElement.msRequestFullscreen) videoElement.msRequestFullscreen();
        } else if (isUsingPlatformPlayer && platformFrame.style.display !== "none") {
            if (platformFrame.requestFullscreen) platformFrame.requestFullscreen();
            else if (platformFrame.mozRequestFullScreen) platformFrame.mozRequestFullScreen();
            else if (platformFrame.webkitRequestFullscreen) platformFrame.webkitRequestFullscreen();
            else if (platformFrame.msRequestFullscreen) platformFrame.msRequestFullscreen();
        }
    }

    function playSelectedChannelFromTV() {
        const items = Array.from(channelList.querySelectorAll('.channel-item'));
        const sel = items.find(item => item.classList.contains('selected'));
        if (sel) {
            const name = sel.querySelector('.channel-name').textContent;
            const filtered = getCurrentFilteredChannels();
            const channel = filtered.find(ch => ch.name === name);
            if (channel) {
                playChannel(channel);
            }
        } else {
            alert('Selecciona un canal con las flechas antes de pulsar Play.');
        }
    }

    function setMode(tv) {
        tvMode = tv;
        if (tvMode) {
            document.getElementById('buttonsContainer').classList.add('hidden');
            tvControls.style.display = 'flex';
            searchButton.classList.remove('hidden');
            searchContainer.style.display = 'block';
            tvModeButton.textContent = 'Modo Android';
            playBtnTv.classList.remove('hidden');
        } else {
            document.getElementById('buttonsContainer').classList.remove('hidden');
            tvControls.style.display = 'none';
            searchContainer.style.display = 'none';
            tvModeButtonAndroid.textContent = 'Modo TV';
            playBtnTv.classList.add('hidden');
        }
    }
    function handleTvModeSwitch() {
        setMode(!tvMode);
    }

    function updateSelectedChannels() {
        selectedChannels = [];
        document.querySelectorAll('.channel-item.selected').forEach(item => {
            const channelName = item.querySelector('.channel-name').textContent;
            // Buscar en la lista filtrada actual
            const filtered = getCurrentFilteredChannels();
            const channel = filtered.find(ch => ch.name === channelName);
            if (channel) selectedChannels.push(channel);
        });
    }

    function saveSelectedChannels() {
        if (selectedChannels.length === 0) {
            alert('No hay canales seleccionados para guardar');
            return;
        }
        let m3uContent = '#EXTM3U\n';
        selectedChannels.forEach(channel => {
            m3uContent += `#EXTINF:-1 tvg-id="${channel.name.replace(/"/g, '')}" tvg-name="${channel.name.replace(/"/g, '')}" tvg-logo="${channel.logo || ''}" group-title="${channel.group || 'Seleccionados'}",${channel.name}\n`;
            m3uContent += `${channel.url}\n`;
        });
        const blob = new Blob([m3uContent], { type: 'application/x-mpegURL' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'canales_seleccionados.m3u';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        alert(`Se han guardado ${selectedChannels.length} canales seleccionados`);
    }

    function selectAllChannels() {
        const channelItems = document.querySelectorAll('.channel-item');
        channelItems.forEach(item => {
            item.classList.add('selected');
        });
        updateSelectedChannels();
    }

    function deselectAllChannels() {
        const channelItems = document.querySelectorAll('.channel-item');
        channelItems.forEach(item => {
            item.classList.remove('selected');
        });
        currentSelectedChannel = null;
        selectedChannels = [];
        if (hls) {
            hls.destroy();
            hls = null;
        }
        videoElement.src = '';
        platformFrame.src = '';
        channelInfo.textContent = '';
    }

    function saveChannelsData() {
        localStorage.setItem('channelsData', JSON.stringify(channelsData));
        isUsingDefaultList = false;
    }
    function loadChannelsData() {
        try {
            const saved = localStorage.getItem('channelsData');
            if (saved) {
                channelsData = JSON.parse(saved);
                if (channelsData && channelsData.length > 0) {
                    isUsingDefaultList = false;
                    return true;
                } else {
                    channelsData = [];
                    return false;
                }
            }
            return false;
        } catch (e) {
            channelsData = [];
            return false;
        }
    }

    function initEvents() {
    	
  
    
    // NUEVO EVENTO para el botón de expandir/retraer lista
    document.getElementById('toggleListBtn').addEventListener('click', toggleChannelList);

    	 toggleNavBtn.addEventListener('click', toggleNavigation);
        prevBtn.addEventListener('click', playPreviousChannel);
        nextBtn.addEventListener('click', playNextChannel);
    	document.getElementById('repSelecButton').addEventListener('click', startRepSelec);
timerButton.addEventListener('click', showTimerModal);
setTimerButton.addEventListener('click', setTimer);
cancelTimerButton.addEventListener('click', hideTimerModal);
        loadButton.addEventListener('click', () => fileInput.click());
        saveButton.addEventListener('click', saveSelectedChannels);
        favButton.addEventListener('click', showFavorites);
        allButton.addEventListener('click', showAllChannels);
        searchButton.addEventListener('click', toggleSearch);
        urlButton.addEventListener('click', showUrlModal);
        addButton.addEventListener('click', showAddChannelModal);
        editButton.addEventListener('click', showEditChannelModal);
        removeButton.addEventListener('click', removeSelectedChannel);
        selectAllButton.addEventListener('click', selectAllChannels);
        deselectAllButton.addEventListener('click', deselectAllChannels);
        fileInput.addEventListener('change', handleFileSelect);
        downloadButton.addEventListener('click', downloadFromUrl);
        cancelButton.addEventListener('click', hideUrlModal);
        searchInput.addEventListener('input', handleSearchInput);
        addChannelButton.addEventListener('click', addOrEditChannel);
        cancelAddChannelButton.addEventListener('click', hideAddChannelModal);
        moreButton.addEventListener('click', toggleSecondaryButtons);
        tvModeButton.addEventListener('click', handleTvModeSwitch);
        tvModeButtonAndroid.addEventListener('click', handleTvModeSwitch);
        fullscreenBtn.addEventListener('click', enterFullscreen);
        fullscreenBtnAndroid.addEventListener('click', enterFullscreen);
        scrollUpBtn.addEventListener('click', () => scrollChannelList('up'));
        scrollDownBtn.addEventListener('click', () => scrollChannelList('down'));
        playBtnTv.addEventListener('click', playSelectedChannelFromTV);
        // NUEVO: Evento para el select de plataforma
        platformFilterSelect.addEventListener('change', function() {
            currentPlatformFilter = this.value;
            updateChannelsDisplayByFilter();
        });
    }

    function getUrlType(url) {
        if (!url) return 'unknown';
        if (url.includes('.m3u8')) return 'TV';
        if (url.includes('.m3u')) return 'TV';
        if (url.includes('.mp4') || url.includes('.webm') || url.includes('.ogg')) return 'video';
        if (url.match(/dailymotion\.com/)) return 'dailymotion';
        if (url.match(/youtube\.com|youtu\.be/)) return 'youtube';
        
        if (url.match(/vimeo\.com/)) return 'vimeo';
        if (url.match(/ok\.ru/)) return 'okru';
        return 'unknown';
    }

    // Devuelve el listado de canales aplicando el filtro de plataforma y búsqueda si aplica
    function getCurrentFilteredChannels() {
        let list = [...channelsData];
        // Aplica filtro de plataforma
        if (currentPlatformFilter !== 'all') {
            list = list.filter(ch => {
                const platform = getUrlType(ch.url);
                return platform === currentPlatformFilter;
            });
        }
        // Aplica filtro de búsqueda si corresponde
        if (currentDisplayMode === 'search' && currentSearchTerm !== '') {
            list = list.filter(channel =>
                channel.name.toLowerCase().includes(currentSearchTerm)
            );
        } else if(currentDisplayMode === 'fav') {
            let filteredFavs = [...favorites];
            if (currentPlatformFilter !== 'all') {
                filteredFavs = filteredFavs.filter(ch => getUrlType(ch.url) === currentPlatformFilter);
            }
            list = filteredFavs;
        }
        return list;
    }

    function updateChannelsDisplayByFilter() {
        // Si modo favoritos, muestra favoritos filtrados por plataforma
        if(currentDisplayMode === 'fav') {
            displayChannels(getCurrentFilteredChannels());
        }
        // Si modo búsqueda, muestra con filtro plataforma y texto
        else if(currentDisplayMode === 'search') {
            handleSearchInput();
        }
        // Si modo todos, muestra todos filtrados por plataforma
        else {
            displayChannels(getCurrentFilteredChannels());
        }
        updateChannelCounter();
    }

    function handleSearchInput() {
        currentSearchTerm = searchInput.value.trim().toLowerCase();
        if (currentSearchTerm === '') {
            displayChannels(getCurrentFilteredChannels());
            return;
        }
        const filteredChannels = getCurrentFilteredChannels().filter(channel =>
            channel.name.toLowerCase().includes(currentSearchTerm)
        );
        displayChannels(filteredChannels);
        updateChannelCounter();
    }

    function showFavorites() {
        currentDisplayMode = 'fav';
        searchContainer.style.display = 'none';
        displayChannels(getCurrentFilteredChannels());
        updateChannelCounter();
    }
    function showAllChannels() {
        currentDisplayMode = 'all';
        searchContainer.style.display = 'none';
        displayChannels(getCurrentFilteredChannels());
        updateChannelCounter();
    }
    function toggleSearch() {
        if (searchContainer.style.display === 'block') {
            searchContainer.style.display = 'none';
            currentDisplayMode = 'all';
            displayChannels(getCurrentFilteredChannels());
        } else {
            searchContainer.style.display = 'block';
            searchInput.focus();
            currentDisplayMode = 'search';
        }
        updateChannelCounter();
    }

    function showUrlModal() {
        urlModal.style.display = 'flex';
        urlInput.focus();
    }
    function hideUrlModal() {
        urlModal.style.display = 'none';
        urlInput.value = '';
    }
    function showAddChannelModal() {
        isEditMode = false;
        editChannelIndex = null;
        addEditModalTitle.textContent = "Añadir nuevo canal";
        addChannelButton.textContent = "Añadir";
        channelNameInput.value = "";
        channelUrlInput.value = "";
        addChannelModal.style.display = 'flex';
        channelNameInput.focus();
    }
    function hideAddChannelModal() {
        addChannelModal.style.display = 'none';
        channelNameInput.value = '';
        channelUrlInput.value = '';
        isEditMode = false;
        editChannelIndex = null;
    }
    function showEditChannelModal() {
        let channelToEdit = null;
        let idx = -1;
        if (selectedChannels.length === 1) {
            channelToEdit = selectedChannels[0];
            idx = channelsData.findIndex(c => c.url === channelToEdit.url && c.name === channelToEdit.name);
        } else if (currentSelectedChannel) {
            channelToEdit = currentSelectedChannel;
            idx = channelsData.findIndex(c => c.url === channelToEdit.url && c.name === channelToEdit.name);
        }
        if (!channelToEdit || idx === -1) {
            alert('Selecciona un canal para editar.');
            return;
        }
        isEditMode = true;
        editChannelIndex = idx;
        addEditModalTitle.textContent = "Editar canal";
        addChannelButton.textContent = "Guardar";
        channelNameInput.value = channelToEdit.name;
        channelUrlInput.value = channelToEdit.url;
        addChannelModal.style.display = 'flex';
        channelNameInput.focus();
    }
    function addOrEditChannel() {
        const name = channelNameInput.value.trim();
        const url = channelUrlInput.value.trim();
        if (!name || !url) {
            alert('Por favor introduce tanto el nombre como la URL del canal');
            return;
        }
        if (isEditMode && editChannelIndex !== null) {
            channelsData[editChannelIndex].name = name;
            channelsData[editChannelIndex].url = url;
            const favIdx = favorites.findIndex(fav => fav.url === currentSelectedChannel.url && fav.name === currentSelectedChannel.name);
            if (favIdx !== -1) {
                favorites[favIdx].name = name;
                favorites[favIdx].url = url;
                localStorage.setItem('favorites', JSON.stringify(favorites));
            }
            saveChannelsData();
            updateChannelsDisplayByFilter();
            hideAddChannelModal();
            isEditMode = false;
            editChannelIndex = null;
        } else {
            const newChannel = { name, url, group: 'Manual', logo: '' };
            channelsData.push(newChannel);
            saveChannelsData();
            updateChannelsDisplayByFilter();
            hideAddChannelModal();
        }
    }
    
    function toggleInterface() {
    const videoContainer = document.querySelector('.video-container');
    const channelList = document.getElementById('channelList');
    const buttonsContainer = document.getElementById('buttonsContainer');
    const searchContainer = document.getElementById('searchContainer');
    const toggleListBtn = document.getElementById('toggleListBtn');
    
    if (navigationEnabled) {
        // Modo ON: mostrar solo reproductor y controles de navegación
        channelList.style.display = 'none';
        buttonsContainer.style.display = 'none';
        searchContainer.style.display = 'none';
        toggleListBtn.style.display = 'none';
        videoContainer.style.height = '85vh';
        navigationControls.style.display = 'flex';
    } else {
        // Modo OFF: mostrar interfaz completa
        channelList.style.display = 'block';
        buttonsContainer.style.display = 'flex';
        searchContainer.style.display = 'none';
        toggleListBtn.style.display = 'block';
        videoContainer.style.height = '40vh';
        navigationControls.style.display = 'none';
    }
}
    function removeSelectedChannel() {
        if (selectedChannels.length > 0) {
            if (!confirm(`¿Seguro que deseas eliminar ${selectedChannels.length} canal(es) seleccionado(s)?`)) return;
            selectedChannels.forEach(selectedChannel => {
                channelsData = channelsData.filter(ch =>
                    ch.url !== selectedChannel.url || ch.name !== selectedChannel.name
                );
                favorites = favorites.filter(fav =>
                    fav.url !== selectedChannel.url || fav.name !== selectedChannel.name
                );
            });
            saveChannelsData();
            localStorage.setItem('favorites', JSON.stringify(favorites));
            const removedCount = selectedChannels.length;
            selectedChannels = [];
            currentSelectedChannel = null;
            updateChannelsDisplayByFilter();
            if (hls) { hls.destroy(); hls = null; }
            videoElement.src = '';
            platformFrame.src = '';
            channelInfo.textContent = '';
            alert(`${removedCount} canal(es) eliminado(s) correctamente.`);
        } else if (currentSelectedChannel) {
            if (!confirm('¿Seguro que deseas eliminar el canal seleccionado?')) return;
            channelsData = channelsData.filter(ch =>
                ch.url !== currentSelectedChannel.url || ch.name !== currentSelectedChannel.name
            );
            saveChannelsData();
            favorites = favorites.filter(fav =>
                fav.url !== currentSelectedChannel.url || fav.name !== currentSelectedChannel.name
            );
            currentSelectedChannel = null;
            localStorage.setItem('favorites', JSON.stringify(favorites));
            updateChannelsDisplayByFilter();
            if (hls) { hls.destroy(); hls = null; }
            videoElement.src = '';
            platformFrame.src = '';
            channelInfo.textContent = '';
            alert('Canal eliminado correctamente.');
        } else {
            alert('Selecciona al menos un canal para quitar.');
        }
    }
    
    function startRepSelec() {
    if (selectedChannels.length === 0) {
        alert('Selecciona al menos un canal para reproducir secuencialmente.');
        return;
    }
    repSelecIndex = 0;
    repSelecPlaying = true;
    playNextRepSelec();
}

function playNextRepSelec() {
    if (!repSelecPlaying || repSelecIndex >= selectedChannels.length) {
        repSelecPlaying = false;
        repSelecIndex = 0;
        return;
    }
    const channel = selectedChannels[repSelecIndex];
    playChannel(channel);

    // Detectar cuando termina el canal (solo para videos, no streams)
    if (videoElement.src && videoElement.src.endsWith('.mp4')) {
        videoElement.onended = () => {
            repSelecIndex++;
            playNextRepSelec();
        };
    } else {
        // Para streams, avanzar manualmente (o con temporizador)
        // Aquí podrías poner un tiempo fijo si quieres auto avanzar
    }
}

function playChannel(channel) {
    // ...Tu función existente para reproducir el canal...
    // Al final de la función, si está en modo repSelec y no es mp4, podrías mostrar un botón para pasar al siguiente
    // Ejemplo:
    if (timerTimeout) {
    clearTimeout(timerTimeout);
    timerTimeout = null;
}
    if (repSelecPlaying) {
        channelInfo.innerHTML += ' <button id="nextRepSelecBtn" style="margin-left:10px;">Siguiente</button>';
        document.getElementById('nextRepSelecBtn').onclick = () => {
            repSelecIndex++;
            playNextRepSelec();
        };
    }
}
    function mergeChannelsAndNotify(newChannels) {
        let repetidos = [];
        let added = 0;
        const existSet = new Set(channelsData.map(c => `${c.name.trim().toLowerCase()}|${c.url.trim()}`));
        newChannels.forEach(channel => {
            const clave = `${channel.name.trim().toLowerCase()}|${channel.url.trim()}`;
            if (existSet.has(clave)) {
                repetidos.push(channel.name);
            } else {
                channelsData.push(channel);
                added++;
                existSet.add(clave);
            }
        });
        saveChannelsData();
        updateChannelsDisplayByFilter();
        let mensaje = `Canales agregados: ${added}.`;
        if (repetidos.length) {
            mensaje += `\nRepetidos no añadidos (${repetidos.length}):\n- ${repetidos.slice(0,10).join('\n- ')}`;
            if (repetidos.length > 10) mensaje += `\n...y ${repetidos.length - 10} más.`;
        }
        alert(mensaje);
        isUsingDefaultList = false;
    }
    function showTimerModal() {
    timerModal.style.display = 'flex';
    timerInput.value = '';
    timerInput.focus();
}
function hideTimerModal() {
    timerModal.style.display = 'none';
    timerInput.value = '';
}
function setTimer() {
    const minutes = parseInt(timerInput.value, 10);
    if (isNaN(minutes) || minutes < 1) {
        alert('Introduce un número válido de minutos');
        return;
    }
    hideTimerModal();
    if (timerTimeout) clearTimeout(timerTimeout);
    timerTimeout = setTimeout(stopPlayback, minutes * 60 * 1000);
    alert(`Temporizador activado: la reproducción se detendrá en ${minutes} minutos.`);
}

function stopPlayback() {
    if (hls) { hls.destroy(); hls = null; }
    videoElement.src = '';
    platformFrame.src = '';
    channelInfo.textContent = '';
    repSelecPlaying = false;
    repSelecIndex = 0;
    alert('¡Temporizador finalizado! La reproducción se ha detenido.');
}
    function toggleFavorite(channel, toggleElement) {
        const index = favorites.findIndex(fav => fav.url === channel.url);
        if (index === -1) {
            favorites.push(channel);
            toggleElement.classList.add('active');
            toggleElement.textContent = '★';
        } else {
            favorites.splice(index, 1);
            toggleElement.classList.remove('active');
            toggleElement.textContent = '☆';
        }
        localStorage.setItem('favorites', JSON.stringify(favorites));
        if (currentDisplayMode === 'fav') {
            updateChannelsDisplayByFilter();
        }
        updateChannelCounter();
    }

    // ----------- LISTA DE CANALES: SELECCION Y DOBLE CLICK -----------
    function displayChannels(channels) {
        channelList.innerHTML = '';
        if (!channels || channels.length === 0) {
            channelList.innerHTML = '<div class="channel-item">No hay canales para mostrar</div>';
            return;
        }
        channels.forEach(channel => {
            const isFavorite = favorites.some(fav => fav.url === channel.url);
            const isSelected = selectedChannels.some(sel => sel.url === channel.url);
            const urlType = getUrlType(channel.url);
            const channelElement = document.createElement('div');
            channelElement.className = `channel-item${isSelected ? ' selected' : ''}`;
            channelElement.innerHTML = `
                <div class="channel-name" title="${channel.name}">${channel.name}</div>
                <span class="channel-type">${urlType}</span>
                <div class="favorite-toggle ${isFavorite ? 'active' : ''}">${isFavorite ? '★' : '☆'}</div>
            `;

            // Para distinguir entre click simple y doble click rápido
            let clickTimeout = null;
            channelElement.addEventListener('dblclick', function(e) {
    if (clickTimeout) {
        clearTimeout(clickTimeout);
        clickTimeout = null;
    }
                
                clickTimeout = setTimeout(() => {
                    clickTimeout = null;
                    // Simple click: seleccionar/des-seleccionar canal
                    if (channelElement.classList.contains('selected')) {
                        channelElement.classList.remove('selected');
                    } else {
                        channelElement.classList.add('selected');
                    }
                    updateSelectedChannels();
                }, 220);
            });
            channelElement.addEventListener('dblclick', function(e) {
                if (clickTimeout) {
                    clearTimeout(clickTimeout);
                    clickTimeout = null;
                }
                document.querySelectorAll('.channel-item.selected').forEach(selectedItem => {
   selectedItem.classList.remove('selected');
                });
   channelElement.classList.add('selected');
                currentSelectedChannel = channel;
                updateSelectedChannels();
                playChannel(channel);
            });
            channelElement.querySelector('.channel-name').addEventListener('click', function(e) {
                e.stopPropagation();
                if (channelElement.classList.contains('selected')) {
                    channelElement.classList.remove('selected');
                } else {
                    channelElement.classList.add('selected');
                }
                updateSelectedChannels();
            });
            channelElement.querySelector('.channel-name').addEventListener('dblclick', function(e) {
                e.stopPropagation();
                if (clickTimeout) {
                    clearTimeout(clickTimeout);
                    clickTimeout = null;
                }
                document.querySelectorAll('.channel-item.selected').forEach(selectedItem => {
                    selectedItem.classList.remove('selected');
                });
                channelElement.classList.add('selected');
                currentSelectedChannel = channel;
                updateSelectedChannels();
                playChannel(channel);
            });
            const favoriteToggle = channelElement.querySelector('.favorite-toggle');
            favoriteToggle.addEventListener('click', (e) => {
                e.stopPropagation();
                toggleFavorite(channel, favoriteToggle);
            });

            channelList.appendChild(channelElement);
        });
    }

    function updateChannelCounter() {
        let count = 0;
        if (currentDisplayMode === 'fav') {
            count = getCurrentFilteredChannels().length;
        } else if(currentDisplayMode === 'search') {
            count = getCurrentFilteredChannels().length;
        } else {
            count = getCurrentFilteredChannels().length;
        }
        channelCounter.textContent = `Canales: ${count}`;
    }

    function loadDefaultList() {
        fetch(DEFAULT_LIST_URL)
            .then(response => {
                if (!response.ok) throw new Error(`Error ${response.status}: ${response.statusText}`);
                return response.text();
            })
            .then(content => {
                channelsData = parseChannelData(content);
                isUsingDefaultList = true;
                updateChannelsDisplayByFilter();
                currentDisplayMode = 'all';
            })
            .catch(error => {
                channelList.innerHTML = `<div class="channel-item">Error cargando la lista por defecto: ${error.message}</div>`;
                updateChannelCounter();
                isUsingDefaultList = false;
            });
    }

    function parseChannelData(data, fileName = '') {
        let jsonChannels = [];
        try {
            if (
                fileName.endsWith('.json') ||
                fileName.endsWith('.JSON') ||
                data.trim().startsWith('{') ||
                data.trim().startsWith('[')
            ) {
                const parsed = JSON.parse(data);
                if (Array.isArray(parsed)) {
                    jsonChannels = parsed.map(ch => ({
                        name: ch.name || ch.title || `Canal ${jsonChannels.length + 1}`,
                        url: ch.url || ch.stream || '',
                        group: ch.group || ch.category || '',
                        logo: ch.logo || ''
                    })).filter(ch => ch.url);
                } else if (parsed.channels && Array.isArray(parsed.channels)) {
                    jsonChannels = parsed.channels.map(ch => ({
                        name: ch.name || ch.title || `Canal ${jsonChannels.length + 1}`,
                        url: ch.url || ch.stream || '',
                        group: ch.group || ch.category || '',
                        logo: ch.logo || ''
                    })).filter(ch => ch.url);
                }
                if (jsonChannels.length > 0) {
                    return jsonChannels;
                }
            }
        } catch (e) {}
        const lines = data.split('\n');
        const channels = [];
        let currentGroup = '';
        let currentLogo = '';
        for (let i = 0; i < lines.length; i++) {
            const line = lines[i].trim();
            if (!line) continue;
            if (line.startsWith('#EXTGRP:')) {
                currentGroup = line.replace('#EXTGRP:', '').trim();
                continue;
            }
            if (line.startsWith('#EXTINF:')) {
                const commaIndex = line.indexOf(',');
                let channelName = commaIndex !== -1 ? line.slice(commaIndex + 1) : `Canal ${channels.length + 1}`;
                const paramsPart = commaIndex !== -1 ? line.slice(0, commaIndex) : line;
                const tvgNameMatch = paramsPart.match(/tvg-name="([^"]*)"/);
                if (tvgNameMatch && tvgNameMatch[1]) {
                    channelName = tvgNameMatch[1];
                }
                const groupMatch = paramsPart.match(/group-title="([^"]*)"/);
                if (groupMatch && groupMatch[1]) {
                    currentGroup = groupMatch[1];
                }
                const logoMatch = paramsPart.match(/tvg-logo="([^"]*)"/);
                currentLogo = logoMatch && logoMatch[1] ? logoMatch[1] : '';
                if (i + 1 < lines.length) {
                    const urlLine = lines[i + 1].trim();
                    if (urlLine && !urlLine.startsWith('#')) {
                        channels.push({
                            name: channelName,
                            url: urlLine,
                            group: currentGroup || '',
                            logo: currentLogo
                        });
                        i++;
                    }
                }
            }
            else if (line.startsWith('http')) {
                channels.push({
                    name: `Canal ${channels.length + 1}`,
                    url: line,
                    group: currentGroup || '',
                    logo: currentLogo
                });
            }
        }
        return channels;
    }
function toggleNavigation() {
    navigationEnabled = !navigationEnabled;
    
    if (navigationEnabled) {
        toggleNavBtn.textContent = 'ON';
        toggleNavBtn.classList.remove('off');
        toggleNavBtn.classList.add('on');
    } else {
        toggleNavBtn.textContent = 'OFF';
        toggleNavBtn.classList.remove('on');
        toggleNavBtn.classList.add('off');
    }
    
    toggleInterface(); // Llamar a la nueva función
} 
    
    // Función para reproducir el canal anterior
    function playPreviousChannel() {
        const filteredChannels = getCurrentFilteredChannels();
        if (filteredChannels.length === 0) return;
        
        if (currentChannelIndex <= 0) {
            currentChannelIndex = filteredChannels.length - 1;
        } else {
            currentChannelIndex--;
        }
        
        playChannel(filteredChannels[currentChannelIndex]);
        updateCurrentFileName(); // Añadir esta línea
    }
    
    // Función para reproducir el siguiente canal
    function playNextChannel() {
        const filteredChannels = getCurrentFilteredChannels();
        if (filteredChannels.length === 0) return;
        
        if (currentChannelIndex >= filteredChannels.length - 1) {
            currentChannelIndex = 0;
        } else {
            currentChannelIndex++;
        }
        
        playChannel(filteredChannels[currentChannelIndex]);
        updateCurrentFileName(); // Añadir esta línea
    }
    
    // Modificar la función playChannel para actualizar el índice actual
    function playChannel(channel) {
        if (!channel || !channel.url) return;
        
        // Detener reproducción actual...
        // (código existente)
        
        // Actualizar el índice del canal actual
        const filteredChannels = getCurrentFilteredChannels();
        currentChannelIndex = filteredChannels.findIndex(c => c.url === channel.url);
        updateCurrentFileName(); // Añadir esta línea
        // Resto de la función existente...
    }
    function handleFileSelect(e) {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = function(e) {
            const content = e.target.result;
            const newChannels = parseChannelData(content, file.name);
            mergeChannelsAndNotify(newChannels);
        };
        reader.readAsText(file);
    }

    function downloadFromUrl() {
        const url = urlInput.value.trim();
        if (!url) {
            alert('Por favor introduce una URL válida');
            return;
        }
        fetch(url)
            .then(response => {
                if (!response.ok) throw new Error(`Error ${response.status}: ${response.statusText}`);
                return response.text();
            })
            .then(content => {
                const ext = url.toLowerCase().split('.').pop();
                const newChannels = parseChannelData(content, url);
                mergeChannelsAndNotify(newChannels);
                hideUrlModal();
            })
            .catch(error => {
                alert('Error al descargar la lista: ' + error.message);
                console.error(error);
            });
    }

    function playChannel(channel) {
    if (!channel || !channel.url) return;
    
    // DETENER REPRODUCCIÓN ACTUAL ANTES DE CAMBIAR
    if (hls) { 
        hls.destroy(); 
        hls = null; 
    }
    if (videoElement.style.display !== "none") {
        videoElement.pause();
        videoElement.src = '';
    }
    if (platformFrame.style.display !== "none") {
        platformFrame.src = '';
    }
    
    const urlType = getUrlType(channel.url);
    channelInfo.textContent = `${channel.name} (${urlType.toUpperCase()})`;
    
    videoElement.style.display = 'none';
    platformFrame.style.display = 'none';
    isUsingPlatformPlayer = false;
    
    switch(urlType) {
        case 'hls': playHlsStream(channel.url); break;
        case 'TV': playDirectVideo(channel.url); break;
        case 'video': playDirectVideo(channel.url); break;
        case 'dailymotion': playDailymotion(channel.url); break;
        case 'youtube': playYouTube(channel.url); break;
        case 'vimeo': playVimeo(channel.url); break;
        case 'okru': playOkRu(channel.url); break;
        default: alert('Tipo de URL no compatible: ' + channel.url); break;
    }
}
    function playHlsStream(url) {
        videoElement.style.display = 'block';
        platformFrame.style.display = 'none';
        isUsingPlatformPlayer = false;
        if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
            videoElement.src = url;
            videoElement.play().catch(e => console.error("Error al reproducir:", e));
        } else if (Hls.isSupported()) {
            hls = new Hls();
            hls.loadSource(url);
            hls.attachMedia(videoElement);
            hls.on(Hls.Events.MANIFEST_PARSED, function() {
                videoElement.play().catch(e => console.error("Error al reproducir:", e));
            });
            hls.on(Hls.Events.ERROR, function(event, data) {
                console.error("HLS Error:", data);
            });
        } else {
            alert('Tu navegador no soporta la reproducción de streams HLS');
        }
    }
    function playDirectVideo(url) {
        videoElement.style.display = 'block';
        platformFrame.style.display = 'none';
        isUsingPlatformPlayer = false;
        videoElement.src = url;
        videoElement.play().catch(e => console.error("Error al reproducir:", e));
    }
    function playDailymotion(url) {
        isUsingPlatformPlayer = true;
        platformFrame.style.display = 'block';
        videoElement.style.display = 'none';
        let videoId = '';
        if (url.includes('/video/')) {
            videoId = url.split('/video/')[1];
            if (videoId.includes('_')) videoId = videoId.split('_')[0];
            if (videoId.includes('?')) videoId = videoId.split('?')[0];
        }
        if (videoId) {
            platformFrame.src = `https://www.dailymotion.com/embed/video/${videoId}?autoplay=1`;
        } else {
            alert('No se pudo extraer el ID del video de Dailymotion');
        }
    }
    function playYouTube(url) {
        isUsingPlatformPlayer = true;
        platformFrame.style.display = 'block';
        videoElement.style.display = 'none';
        let videoId = '';
        if (url.includes('v=')) {
            videoId = url.split('v=')[1];
            if (videoId.includes('&')) videoId = videoId.split('&')[0];
        } else if (url.includes('youtu.be/')) {
            videoId = url.split('youtu.be/')[1];
            if (videoId.includes('?')) videoId = videoId.split('?')[0];
        }
        if (videoId) {
            platformFrame.src = `https://www.youtube.com/embed/${videoId}?autoplay=1`;
        } else {
            alert('No se pudo extraer el ID del video de YouTube');
        }
    }
    function playVimeo(url) {
        isUsingPlatformPlayer = true;
        platformFrame.style.display = 'block';
        videoElement.style.display = 'none';
        let videoId = '';
        if (url.includes('vimeo.com/')) {
            videoId = url.split('vimeo.com/')[1];
            if (videoId.includes('?')) videoId = videoId.split('?')[0];
        }
        if (videoId) {
            platformFrame.src = `https://player.vimeo.com/video/${videoId}?autoplay=1`;
        } else {
            alert('No se pudo extraer el ID del video de Vimeo');
        }
    }
    function playOkRu(url) {
        isUsingPlatformPlayer = true;
        platformFrame.style.display = 'block';
        videoElement.style.display = 'none';
        let videoId = '';
        if (url.includes('/video/')) {
            videoId = url.split('/video/')[1].split(/[/?&#]/)[0];
        } else if (url.match(/ok\.ru\/videoembed\//)) {
            videoId = url.split('/videoembed/')[1].split(/[/?&#]/)[0];
        }
        if (videoId) {
            platformFrame.src = `https://ok.ru/videoembed/${videoId}`;
        } else {
            platformFrame.src = url;
        }
    }
    function updateCurrentFileName() {
    if (currentChannelIndex >= 0) {
        const filteredChannels = getCurrentFilteredChannels();
        const currentChannel = filteredChannels[currentChannelIndex];
        channelInfo.textContent = currentChannel.name;
    }
}

    function initApp() {
        initEvents();
        if (loadChannelsData()) {
            updateChannelsDisplayByFilter();
            currentDisplayMode = 'all';
            isUsingDefaultList = false;
        } else {
            loadDefaultList();
        }
        updateChannelCounter();
        setMode(false);
    }
    document.addEventListener('DOMContentLoaded', initApp);

    document.addEventListener('keydown', function(e){
        if (!tvMode) return;
        if (e.key === 'ArrowUp') { scrollChannelList('up'); e.preventDefault();}
        if (e.key === 'ArrowDown') { scrollChannelList('down'); e.preventDefault();}
        if (e.key === 'Enter') {
            playSelectedChannelFromTV();
            e.preventDefault();
        }
    });
    </script>
</body>
</html>