<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lector de Noticias RSS</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #1e5799 0%,#207cca 51%,#2989d8 100%);
            color: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .description {
            font-size: 1.1rem;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .btn-reload {
            background-color: #4CAF50;
            color: white;
        }
        
        .btn-reload:hover {
            background-color: #3e8e41;
            transform: translateY(-2px);
        }
        
        .btn-read {
            background-color: #2196F3;
            color: white;
        }
        
        .btn-read:hover {
            background-color: #0b7dda;
            transform: translateY(-2px);
        }
        
        .btn-stop {
            background-color: #f44336;
            color: white;
        }
        
        .btn-stop:hover {
            background-color: #d32f2f;
            transform: translateY(-2px);
        }
        
        .container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }
        
        .newspaper {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.08);
            transition: transform 0.3s ease;
        }
        
        .newspaper:hover {
            transform: translateY(-5px);
        }
        
        .newspaper-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .newspaper-icon {
            width: 40px;
            height: 40px;
            margin-right: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            border-radius: 50%;
        }
        
        .newspaper-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: #2c3e50;
        }
        
        .news-list {
            list-style: none;
        }
        
        .news-item {
            padding: 12px 0;
            border-bottom: 1px solid #eee;
        }
        
        .news-item:last-child {
            border-bottom: none;
        }
        
        .news-title {
            font-weight: 500;
            margin-bottom: 5px;
            color: #333;
        }
        
        .news-date {
            font-size: 0.8rem;
            color: #777;
        }
        
        .news-image {
            width: 100%;
            border-radius: 8px;
            margin-top: 10px;
            height: 160px;
            object-fit: cover;
        }
        
        .status {
            text-align: center;
            padding: 15px;
            margin-top: 20px;
            background-color: #fff9c4;
            border-radius: 8px;
            font-weight: 500;
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: #777;
            font-size: 0.9rem;
        }
        
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100px;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
            
            .btn {
                width: 200px;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>Lector de Noticias RSS</h1>
        <p class="description">Últimas noticias de los principales periódicos de España. Actualizado automáticamente desde sus feeds RSS.</p>
    </header>
    
    <div class="controls">
        <button class="btn btn-reload" onclick="cargarNoticias()">Releer Noticias</button>
        <button class="btn btn-read" onclick="leerNoticias()">Leer en Voz Alta</button>
        <button class="btn btn-stop" onclick="detenerLectura()">Detener Lectura</button>
    </div>
    
    <div class="container" id="contenedor-noticias">
        <div class="loading">
            <div class="spinner"></div>
        </div>
    </div>
    
    <div class="status" id="status">
        Cargando noticias desde los feeds RSS...
    </div>
    
    <footer>
        <p>Lector de noticias &copy; 2023 | Actualizado automáticamente desde las fuentes originales</p>
    </footer>

    <script>
        // URLs de los feeds RSS (algunos pueden requerir proxy por políticas CORS)
        const feeds = {
            'elpais': 'https://feeds.elpais.com/mrss-s/pages/ep/site/elpais.com/portada',
            'elmundo': 'https://e00-elmundo.uecdn.es/elmundo/rss/portada.xml',
            'abc': 'https://www.abc.es/rss/feeds/abcPortada.xml',
            'lavanguardia': 'https://www.lavanguardia.com/rss/home.xml',
            'efe': 'https://efe.com/feed/'
        };

        // Nombres completos de los periódicos
        const newspaperNames = {
            'elpais': 'El País',
            'elmundo': 'El Mundo',
            'abc': 'ABC',
            'lavanguardia': 'La Vanguardia',
            'efe': 'Agencia EFE'
        };

        // Colores para cada periódico
        const newspaperColors = {
            'elpais': '#E41B23',
            'elmundo': '#00A0E3',
            'abc': '#000000',
            'lavanguardia': '#001E50',
            'efe': '#D52B1E'
        };

        // Iniciales para los iconos
        const newspaperInitials = {
            'elpais': 'EP',
            'elmundo': 'EM',
            'abc': 'ABC',
            'lavanguardia': 'LV',
            'efe': 'EF'
        };

        // Almacenar las noticias cargadas
        let noticiasCargadas = [];

        // Cargar noticias al iniciar la página
        document.addEventListener('DOMContentLoaded', cargarNoticias);

        // Función para obtener y mostrar noticias
        async function cargarNoticias() {
            const contenedor = document.getElementById('contenedor-noticias');
            const status = document.getElementById('status');
            
            // Mostrar estado de carga
            contenedor.innerHTML = '<div class="loading"><div class="spinner"></div></div>';
            status.textContent = 'Cargando noticias desde los feeds RSS...';
            
            // Limpiar noticias anteriores
            noticiasCargadas = [];
            
            try {
                // Intentar cargar noticias de cada feed
                for (const [key, url] of Object.entries(feeds)) {
                    try {
                        // Usar un proxy CORS para evitar problemas de same-origin policy
                        const proxyUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`;
                        const response = await fetch(proxyUrl);
                        
                        if (!response.ok) {
                            throw new Error(`Error al cargar ${key}: ${response.status}`);
                        }
                        
                        const text = await response.text();
                        const parser = new DOMParser();
                        const xmlDoc = parser.parseFromString(text, "text/xml");
                        
                        // Extraer noticias del feed
                        const items = xmlDoc.querySelectorAll('item');
                        const noticias = [];
                        
                        // Limitar a 10 noticias por periódico
                        const limite = Math.min(items.length, 10);
                        
                        for (let i = 0; i < limite; i++) {
                            const item = items[i];
                            const titulo = item.querySelector('title')?.textContent || 'Sin título';
                            const enlace = item.querySelector('link')?.textContent || '#';
                            const fecha = item.querySelector('pubDate')?.textContent || 'Fecha no disponible';
                            const descripcion = item.querySelector('description')?.textContent || '';
                            
                            // Intentar extraer imagen
                            let imagen = '';
                            const contenido = item.querySelector('content\\:encoded, encoded, description');
                            if (contenido) {
                                const imgMatch = contenido.textContent.match(/<img[^>]+src="([^">]+)"/);
                                if (imgMatch && imgMatch[1]) {
                                    imagen = imgMatch[1];
                                }
                            }
                            
                            // Si no se encontró imagen en el contenido, buscar en media:content
                            if (!imagen) {
                                const mediaContent = item.querySelector('media\\:content, content');
                                if (mediaContent) {
                                    imagen = mediaContent.getAttribute('url') || '';
                                }
                            }
                            
                            noticias.push({
                                titulo,
                                enlace,
                                fecha: new Date(fecha).toLocaleString('es-ES'),
                                imagen,
                                descripcion
                            });
                            
                            // Añadir a la lista completa de noticias para la función de voz
                            noticiasCargadas.push({
                                periodico: newspaperNames[key],
                                titulo,
                                fecha: new Date(fecha).toLocaleString('es-ES')
                            });
                        }
                        
                        // Mostrar las noticias de este periódico
                        mostrarNoticias(key, noticias);
                        
                    } catch (error) {
                        console.error(`Error al procesar ${key}:`, error);
                        mostrarError(key, error.message);
                    }
                }
                
                status.textContent = 'Noticias cargadas correctamente.';
                
            } catch (error) {
                console.error('Error general:', error);
                status.textContent = `Error: ${error.message}. Recargue la página o intente más tarde.`;
            }
        }

        // Función para mostrar noticias en el DOM
        function mostrarNoticias(periodicoKey, noticias) {
            const contenedor = document.getElementById('contenedor-noticias');
            
            // Si el contenedor todavía tiene el spinner, limpiarlo
            if (contenedor.querySelector('.loading')) {
                contenedor.innerHTML = '';
            }
            
            const periodicoDiv = document.createElement('div');
            periodicoDiv.className = 'newspaper';
            
            // Crear encabezado del periódico
            const headerDiv = document.createElement('div');
            headerDiv.className = 'newspaper-header';
            
            const iconDiv = document.createElement('div');
            iconDiv.className = 'newspaper-icon';
            iconDiv.style.backgroundColor = newspaperColors[periodicoKey];
            iconDiv.textContent = newspaperInitials[periodicoKey];
            
            const titleH2 = document.createElement('h2');
            titleH2.className = 'newspaper-title';
            titleH2.textContent = newspaperNames[periodicoKey];
            
            headerDiv.appendChild(iconDiv);
            headerDiv.appendChild(titleH2);
            
            // Crear lista de noticias
            const listaUl = document.createElement('ul');
            listaUl.className = 'news-list';
            
            noticias.forEach(noticia => {
                const itemLi = document.createElement('li');
                itemLi.className = 'news-item';
                
                const tituloDiv = document.createElement('div');
                tituloDiv.className = 'news-title';
                
                const enlace = document.createElement('a');
                enlace.href = noticia.enlace;
                enlace.target = '_blank';
                enlace.rel = 'noopener noreferrer';
                enlace.textContent = noticia.titulo;
                
                tituloDiv.appendChild(enlace);
                
                const fechaDiv = document.createElement('div');
                fechaDiv.className = 'news-date';
                fechaDiv.textContent = noticia.fecha;
                
                itemLi.appendChild(tituloDiv);
                itemLi.appendChild(fechaDiv);
                
                // Añadir imagen si está disponible
                if (noticia.imagen) {
                    const imagen = document.createElement('img');
                    imagen.className = 'news-image';
                    imagen.src = noticia.imagen;
                    imagen.alt = noticia.titulo;
                    itemLi.appendChild(imagen);
                }
                
                listaUl.appendChild(itemLi);
            });
            
            periodicoDiv.appendChild(headerDiv);
            periodicoDiv.appendChild(listaUl);
            
            contenedor.appendChild(periodicoDiv);
        }

        // Función para mostrar errores de carga
        function mostrarError(periodicoKey, mensaje) {
            const contenedor = document.getElementById('contenedor-noticias');
            
            // Si el contenedor todavía tiene el spinner, limpiarlo
            if (contenedor.querySelector('.loading')) {
                contenedor.innerHTML = '';
            }
            
            const periodicoDiv = document.createElement('div');
            periodicoDiv.className = 'newspaper';
            
            // Crear encabezado del periódico
            const headerDiv = document.createElement('div');
            headerDiv.className = 'newspaper-header';
            
            const iconDiv = document.createElement('div');
            iconDiv.className = 'newspaper-icon';
            iconDiv.style.backgroundColor = newspaperColors[periodicoKey];
            iconDiv.textContent = newspaperInitials[periodicoKey];
            
            const titleH2 = document.createElement('h2');
            titleH2.className = 'newspaper-title';
            titleH2.textContent = newspaperNames[periodicoKey];
            
            headerDiv.appendChild(iconDiv);
            headerDiv.appendChild(titleH2);
            
            // Mensaje de error
            const errorDiv = document.createElement('div');
            errorDiv.style.padding = '15px';
            errorDiv.style.color = '#d32f2f';
            errorDiv.innerHTML = `<strong>Error al cargar noticias:</strong> ${mensaje}`;
            
            periodicoDiv.appendChild(headerDiv);
            periodicoDiv.appendChild(errorDiv);
            
            contenedor.appendChild(periodicoDiv);
        }

        // Función para leer el contenido con voz
        function leerNoticias() {
            if (noticiasCargadas.length === 0) {
                alert('No hay noticias cargadas. Por favor, recargue primero las noticias.');
                return;
            }
            
            // Verificar si el navegador soporta la síntesis de voz
            if (!('speechSynthesis' in window)) {
                alert('Lo siento, tu navegador no soporta la función de lectura por voz.');
                return;
            }
            
            // Detener cualquier lectura previa
            window.speechSynthesis.cancel();
            
            // Crear texto para leer
            let textoCompleto = "Resumen de las últimas noticias. ";
            
            noticiasCargadas.forEach(noticia => {
                textoCompleto += `Del periódico ${noticia.periodico}. ${noticia.titulo}. Publicada el ${noticia.fecha}. `;
            });
            
            // Crear un objeto de utterance (lo que se va a leer)
            const utterance = new SpeechSynthesisUtterance(textoCompleto);
            
            // Configurar la voz en español
            const voces = speechSynthesis.getVoices();
            let vozEspanol = voces.find(voz => voz.lang.startsWith('es'));
            
            if (vozEspanol) {
                utterance.voice = vozEspanol;
            }
            
            utterance.rate = 0.9; // Velocidad de lectura ligeramente más lenta para mejor comprensión
            utterance.pitch = 1.0; // Tono de voz normal
            utterance.volume = 1.0; // Volumen máximo
            
            // Evento cuando termina la lectura
            utterance.onend = function() {
                document.getElementById('status').textContent = 'Lectura finalizada.';
            };
            
            // Leer el texto
            window.speechSynthesis.speak(utterance);
            document.getElementById('status').textContent = 'Leyendo noticias...';
        }

        // Función para detener la lectura
        function detenerLectura() {
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();
                document.getElementById('status').textContent = 'Lectura detenida.';
            }
        }
    </script>
</body>
</html>